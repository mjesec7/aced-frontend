import{_ as S,m as A,u as T,P as N,c as u,a as s,b as C,d as I,e as h,t as a,w as k,f as v,r as P,g as D,v as j,n as g,F as B,h as L,i as m,j as F,T as U,k as z,l as H,o as Q,p as q,q as V,s as d}from"./index-LtUQSqMT.js";const E={name:"MyCoursesPage",components:{PaymentModal:N},mixins:[T],data(){return{userId:null,studyList:[],userProgress:[],loading:!0,searchQuery:"",filterProgress:"",filterSubject:"",sortBy:"recent",activeMenu:null,showPaywall:!1,requestedTopicId:null,deleteModal:{show:!1,course:null,deleting:!1}}},computed:{...A("user",{vuexUserStatus:"userStatus"}),currentUserStatus(){return this.vuexUserStatus||localStorage.getItem("userStatus")||"free"},subjects(){const t=new Set;return this.studyList.forEach(e=>{e.subject&&t.add(e.subject)}),Array.from(t).sort()},filteredCourses(){let t=[...this.studyList];if(this.searchQuery.trim()){const e=this.searchQuery.toLowerCase();t=t.filter(i=>{const n=this.getCourseName(i).toLowerCase(),o=(i.subject||"").toLowerCase();return n.includes(e)||o.includes(e)})}return this.filterProgress&&(t=t.filter(e=>{var n;const i=((n=e.progress)==null?void 0:n.percent)||0;switch(this.filterProgress){case"not-started":return i===0;case"in-progress":return i>0&&i<100;case"completed":return i===100;default:return!0}})),this.filterSubject&&(t=t.filter(e=>e.subject===this.filterSubject)),t.sort((e,i)=>{var n,o;switch(this.sortBy){case"progress":return(((n=i.progress)==null?void 0:n.percent)||0)-(((o=e.progress)==null?void 0:o.percent)||0);case"name":return this.getCourseName(e).localeCompare(this.getCourseName(i));case"level":return(e.level||0)-(i.level||0);case"recent":default:return new Date(i.lastAccessed||0)-new Date(e.lastAccessed||0)}}),t},inProgressCount(){return this.studyList.filter(t=>{var i;const e=((i=t.progress)==null?void 0:i.percent)||0;return e>0&&e<100}).length},completedCount(){return this.studyList.filter(t=>{var e;return((e=t.progress)==null?void 0:e.percent)===100}).length},totalHours(){return(this.studyList.reduce((e,i)=>{var n;return e+(((n=i.progress)==null?void 0:n.completedTime)||0)},0)/60).toFixed(1)},hasActiveFilters(){return!!(this.searchQuery||this.filterProgress||this.filterSubject||this.sortBy!=="recent")}},async mounted(){await this.initialize(),document.addEventListener("click",this.closeMenu)},beforeUnmount(){document.removeEventListener("click",this.closeMenu)},methods:{async initialize(){var t,e;if(this.userId=((e=(t=this.$store)==null?void 0:t.state)==null?void 0:e.firebaseUserId)||localStorage.getItem("firebaseUserId"),!this.userId){this.$router.push("/");return}await this.loadCourses()},async loadCourses(){try{this.loading=!0;const[t,e]=await Promise.all([q(this.userId),V(this.userId)]);e!=null&&e.success&&Array.isArray(e.data)&&(this.userProgress=e.data),t!=null&&t.success&&Array.isArray(t.data)&&(this.studyList=await this.enrichCourses(t.data))}catch{}finally{this.loading=!1}},async enrichCourses(t){const e=[];for(const i of t)if(i!=null&&i.topicId)try{const n=await H(i.topicId);let o=n!=null&&n.success?n.data:i;if(!o.lessons||o.lessons.length===0){const c=await Q(i.topicId);c!=null&&c.success&&c.data&&(o.lessons=c.data)}const l=this.calculateProgress(o.lessons);e.push({...o,progress:l,lastAccessed:i.lastAccessed||new Date().toISOString()})}catch{}return e},calculateProgress(t){if(!t||t.length===0)return{percent:0,completedLessons:0,totalLessons:0,completedTime:0,totalTime:0};let e=0,i=0,n=0;return t.forEach(o=>{const l=o.estimatedTime||o.duration||10;n+=l;const c=this.userProgress.find(p=>{var r;return(((r=p.lessonId)==null?void 0:r._id)||p.lessonId)===o._id});c!=null&&c.completed&&(e++,i+=l)}),{percent:Math.round(e/t.length*100),completedLessons:e,totalLessons:t.length,completedTime:i,totalTime:n}},getCourseName(t){return t.name||t.topicName||t.topic||t.title||"Untitled"},getTypeClass(t){return t.type||"free"},getTypeLabel(t){return{free:"Free",premium:"Start",pro:"Pro"}[t.type||"free"]||"Free"},getProgressColor(t){return t>=80?"high":t>=50?"medium":t>=30?"low":"very-low"},formatTime(t){if(!t)return"0 min";const e=Math.floor(t/60),i=t%60;return e>0?`${e}h ${i}m`:`${i} min`},getNextLesson(t){var n;if(!t.lessons||t.lessons.length===0)return"No lessons";const e=((n=t.progress)==null?void 0:n.completedLessons)||0;if(e>=t.lessons.length)return"Course completed";const i=t.lessons[e];return this.getLocalizedLessonName(i)||`Lesson ${e+1}`},getLocalizedLessonName(t){if(!t)return"";const e=localStorage.getItem("lang")||"ru";if(t.title&&typeof t.title=="string")return t.title;if(t.lessonName){if(typeof t.lessonName=="string")return t.lessonName;if(typeof t.lessonName=="object")return t.lessonName[e]||t.lessonName.en||t.lessonName.ru||t.lessonName.uz||""}return""},getCourseWord(t){return t===1?"course":"courses"},clearFilters(){this.searchQuery="",this.filterProgress="",this.filterSubject="",this.sortBy="recent"},toggleMenu(t){this.activeMenu=this.activeMenu===t?null:t},closeMenu(){this.activeMenu=null},openCourse(t){this.$router.push(`/topic/${t._id}/overview`)},continueCourse(t){if(!this.hasTopicAccess(t)){this.requestedTopicId=t._id,this.showPaywall=!0;return}this.$router.push(`/topic/${t._id}/overview`)},hasTopicAccess(t){const e=t.type||"free",i=this.currentUserStatus;return e==="free"||e==="premium"&&(i==="start"||i==="pro")||e==="pro"&&i==="pro"},showDeleteModal(t){this.deleteModal.course=t,this.deleteModal.show=!0,this.activeMenu=null},closeDeleteModal(){this.deleteModal.show=!1,this.deleteModal.course=null,this.deleteModal.deleting=!1},async confirmDelete(){if(!(!this.deleteModal.course||this.deleteModal.deleting))try{this.deleteModal.deleting=!0,await z(this.userId,this.deleteModal.course._id),this.studyList=this.studyList.filter(t=>t._id!==this.deleteModal.course._id),window.eventBus&&window.eventBus.emit("studyListUpdated"),this.closeDeleteModal()}catch{alert("Failed to delete course"),this.deleteModal.deleting=!1}},handlePaymentSuccess(t){this.showPaywall=!1,this.$forceUpdate()}}},G={class:"my-courses-page"},O={class:"page-header"},W={class:"header-content"},Y={class:"header-left"},J={class:"page-subtitle"},K={class:"header-actions"},X={class:"filters-section"},Z={class:"filters-content"},R={class:"search-box"},$={class:"filter-chips"},ee={class:"filter-group"},se={class:"chips-row"},te={key:0,class:"filter-group"},re={class:"chips-row"},oe=["onClick"],le={class:"filter-group"},ie={class:"chips-row"},ne={class:"stats-overview"},ae={class:"stat-item"},de={class:"stat-info"},ue={class:"stat-value"},ce={class:"stat-item"},ve={class:"stat-info"},ge={class:"stat-value"},he={class:"stat-item"},pe={class:"stat-info"},fe={class:"stat-value"},me={class:"stat-item"},ye={class:"stat-info"},Ce={class:"stat-value"},ke={key:0,class:"loading-state"},we={key:1,class:"empty-state"},be={class:"empty-title"},xe={class:"empty-text"},Me={class:"empty-actions"},_e={key:2,class:"courses-grid"},Pe=["onClick"],Be={class:"course-header"},Le={class:"course-menu"},Se=["onClick"],Ae=["onClick"],Te=["onClick"],Ne={class:"course-content"},Ie={class:"course-title"},De={class:"course-meta"},je={class:"meta-tag"},Fe={class:"meta-tag"},Ue={class:"progress-section"},ze={class:"progress-info"},He={class:"progress-value"},Qe={class:"progress-bar-wrapper"},qe={class:"progress-stats"},Ve={class:"progress-percent"},Ee={class:"time-spent"},Ge={class:"course-footer"},Oe={class:"next-lesson"},We=["onClick"],Ye={class:"modal-header"},Je={class:"modal-body"},Ke={class:"modal-text"},Xe={class:"modal-footer"},Ze=["disabled"],Re={key:0},$e={key:1,class:"deleting-text"};function es(t,e,i,n,o,l){const c=P("router-link"),p=P("PaymentModal");return d(),u("div",G,[s("div",O,[s("div",W,[s("div",Y,[s("button",{class:"back-btn",onClick:e[0]||(e[0]=r=>t.$router.push("/profile/main"))},e[20]||(e[20]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"15 18 9 12 15 6"})],-1)])),s("div",null,[e[21]||(e[21]=s("h1",{class:"page-title"},"My Courses",-1)),s("p",J,a(l.filteredCourses.length)+" "+a(l.getCourseWord(l.filteredCourses.length)),1)])]),s("div",K,[C(c,{to:"/profile/catalogue",class:"add-course-btn"},{default:k(()=>e[22]||(e[22]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),v(" Add Course ")])),_:1})])])]),s("div",X,[s("div",Z,[s("div",R,[e[24]||(e[24]=s("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"11",cy:"11",r:"8"}),s("path",{d:"m21 21-4.35-4.35"})],-1)),D(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.searchQuery=r),type:"text",class:"search-input",placeholder:"Search courses..."},null,512),[[j,o.searchQuery]]),o.searchQuery?(d(),u("button",{key:0,onClick:e[2]||(e[2]=r=>o.searchQuery=""),class:"clear-search-btn"},e[23]||(e[23]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))):h("",!0)]),s("div",$,[s("div",ee,[e[25]||(e[25]=s("label",{class:"filter-label"},"Progress:",-1)),s("div",se,[s("button",{class:g(["filter-chip",{active:o.filterProgress===""}]),onClick:e[3]||(e[3]=r=>o.filterProgress="")}," All ",2),s("button",{class:g(["filter-chip",{active:o.filterProgress==="not-started"}]),onClick:e[4]||(e[4]=r=>o.filterProgress="not-started")}," Not Started ",2),s("button",{class:g(["filter-chip",{active:o.filterProgress==="in-progress"}]),onClick:e[5]||(e[5]=r=>o.filterProgress="in-progress")}," In Progress ",2),s("button",{class:g(["filter-chip",{active:o.filterProgress==="completed"}]),onClick:e[6]||(e[6]=r=>o.filterProgress="completed")}," Completed ",2)])]),l.subjects.length>0?(d(),u("div",te,[e[26]||(e[26]=s("label",{class:"filter-label"},"Subject:",-1)),s("div",re,[s("button",{class:g(["filter-chip",{active:o.filterSubject===""}]),onClick:e[7]||(e[7]=r=>o.filterSubject="")}," All ",2),(d(!0),u(B,null,L(l.subjects,r=>(d(),u("button",{key:r,class:g(["filter-chip",{active:o.filterSubject===r}]),onClick:y=>o.filterSubject=r},a(r),11,oe))),128))])])):h("",!0),s("div",le,[e[27]||(e[27]=s("label",{class:"filter-label"},"Sort By:",-1)),s("div",ie,[s("button",{class:g(["filter-chip",{active:o.sortBy==="recent"}]),onClick:e[8]||(e[8]=r=>o.sortBy="recent")}," By Date ",2),s("button",{class:g(["filter-chip",{active:o.sortBy==="progress"}]),onClick:e[9]||(e[9]=r=>o.sortBy="progress")}," By Progress ",2),s("button",{class:g(["filter-chip",{active:o.sortBy==="name"}]),onClick:e[10]||(e[10]=r=>o.sortBy="name")}," By Name ",2)])])]),l.hasActiveFilters?(d(),u("button",{key:0,onClick:e[11]||(e[11]=(...r)=>l.clearFilters&&l.clearFilters(...r)),class:"clear-all-btn"},e[28]||(e[28]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),v(" Clear Filters ")]))):h("",!0)])]),s("div",ne,[s("div",ae,[e[30]||(e[30]=s("div",{class:"stat-icon purple"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),s("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})])],-1)),s("div",de,[s("div",ue,a(o.studyList.length),1),e[29]||(e[29]=s("div",{class:"stat-label"},"Total",-1))])]),s("div",ce,[e[32]||(e[32]=s("div",{class:"stat-icon blue"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})])],-1)),s("div",ve,[s("div",ge,a(l.inProgressCount),1),e[31]||(e[31]=s("div",{class:"stat-label"},"In Progress",-1))])]),s("div",he,[e[34]||(e[34]=s("div",{class:"stat-icon green"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"20 6 9 17 4 12"})])],-1)),s("div",pe,[s("div",fe,a(l.completedCount),1),e[33]||(e[33]=s("div",{class:"stat-label"},"Completed",-1))])]),s("div",me,[e[36]||(e[36]=s("div",{class:"stat-icon orange"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"12",cy:"12",r:"10"}),s("polyline",{points:"12 6 12 12 16 14"})])],-1)),s("div",ye,[s("div",Ce,a(l.totalHours)+"h",1),e[35]||(e[35]=s("div",{class:"stat-label"},"Studied",-1))])])]),o.loading?(d(),u("div",ke,e[37]||(e[37]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading courses...",-1)]))):l.filteredCourses.length===0?(d(),u("div",we,[e[39]||(e[39]=s("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),s("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})],-1)),s("h3",be,a(l.hasActiveFilters?"No courses found":"You don't have any courses yet"),1),s("p",xe,a(l.hasActiveFilters?"Try changing your search filters":"Add courses from the catalog to start learning"),1),s("div",Me,[l.hasActiveFilters?(d(),u("button",{key:0,onClick:e[12]||(e[12]=(...r)=>l.clearFilters&&l.clearFilters(...r)),class:"secondary-btn"}," Clear Filters ")):h("",!0),C(c,{to:"/profile/catalogue",class:"primary-btn"},{default:k(()=>e[38]||(e[38]=[v(" Go to Catalog ")])),_:1})])])):(d(),u("div",_e,[(d(!0),u(B,null,L(l.filteredCourses,r=>{var y,w,b,x,M,_;return d(),u("div",{key:r._id,class:"course-card",onClick:f=>l.openCourse(r)},[s("div",Be,[s("span",{class:g(["course-type-badge",l.getTypeClass(r)])},a(l.getTypeLabel(r)),3),s("div",Le,[s("button",{class:"menu-btn",onClick:m(f=>l.toggleMenu(r._id),["stop"])},e[40]||(e[40]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"12",cy:"12",r:"1"}),s("circle",{cx:"12",cy:"5",r:"1"}),s("circle",{cx:"12",cy:"19",r:"1"})],-1)]),8,Se),o.activeMenu===r._id?(d(),u("div",{key:0,class:"menu-dropdown",onClick:e[13]||(e[13]=m(()=>{},["stop"]))},[s("button",{onClick:f=>l.openCourse(r),class:"menu-item"},e[41]||(e[41]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polygon",{points:"5 3 19 12 5 21 5 3"})],-1),v(" Open Course ")]),8,Ae),s("button",{onClick:f=>l.showDeleteModal(r),class:"menu-item danger"},e[42]||(e[42]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"3 6 5 6 21 6"}),s("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1),v(" Delete ")]),8,Te)])):h("",!0)])]),s("div",Ne,[s("h3",Ie,a(l.getCourseName(r)),1),s("div",De,[s("span",je,[e[43]||(e[43]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})],-1)),v(" "+a(r.subject||"General"),1)]),s("span",Fe,[e[44]||(e[44]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})],-1)),v(" Level "+a(r.level||1),1)])]),s("div",Ue,[s("div",ze,[e[45]||(e[45]=s("span",{class:"progress-label"},"Progress",-1)),s("span",He,a(((y=r.progress)==null?void 0:y.completedLessons)||0)+"/"+a(((w=r.lessons)==null?void 0:w.length)||0),1)]),s("div",Qe,[s("div",{class:g(["progress-bar",l.getProgressColor(((b=r.progress)==null?void 0:b.percent)||0)]),style:F({width:`${((x=r.progress)==null?void 0:x.percent)||0}%`})},null,6)]),s("div",qe,[s("span",Ve,a(((M=r.progress)==null?void 0:M.percent)||0)+"%",1),s("span",Ee,a(l.formatTime((_=r.progress)==null?void 0:_.completedTime)),1)])])]),s("div",Ge,[s("div",Oe,[e[46]||(e[46]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"12",cy:"12",r:"10"}),s("polyline",{points:"12 6 12 12 16 14"})],-1)),s("span",null,a(l.getNextLesson(r)),1)]),s("button",{onClick:m(f=>l.continueCourse(r),["stop"]),class:"continue-btn"},e[47]||(e[47]=[v(" Continue "),s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"9 18 15 12 9 6"})],-1)]),8,We)])],8,Pe)}),128))])),C(U,{name:"modal"},{default:k(()=>[o.deleteModal.show?(d(),u("div",{key:0,class:"modal-overlay",onClick:e[18]||(e[18]=(...r)=>l.closeDeleteModal&&l.closeDeleteModal(...r))},[s("div",{class:"modal-container",onClick:e[17]||(e[17]=m(()=>{},["stop"]))},[s("div",Ye,[e[49]||(e[49]=s("div",{class:"modal-icon danger"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),s("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),s("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})])],-1)),s("button",{class:"modal-close",onClick:e[14]||(e[14]=(...r)=>l.closeDeleteModal&&l.closeDeleteModal(...r))},e[48]||(e[48]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))]),s("div",Je,[e[52]||(e[52]=s("h3",{class:"modal-title"},"Delete Course?",-1)),s("p",Ke,[e[50]||(e[50]=v(" Are you sure you want to delete the course ")),s("strong",null,a(o.deleteModal.course?l.getCourseName(o.deleteModal.course):""),1),e[51]||(e[51]=v("? This action cannot be undone. "))])]),s("div",Xe,[s("button",{onClick:e[15]||(e[15]=(...r)=>l.closeDeleteModal&&l.closeDeleteModal(...r)),class:"modal-btn secondary"}," Cancel "),s("button",{onClick:e[16]||(e[16]=(...r)=>l.confirmDelete&&l.confirmDelete(...r)),class:"modal-btn danger",disabled:o.deleteModal.deleting},[o.deleteModal.deleting?(d(),u("span",$e,e[53]||(e[53]=[s("span",{class:"spinner-small"},null,-1),v(" Deleting... ")]))):(d(),u("span",Re,"Delete"))],8,Ze)])])])):h("",!0)]),_:1}),o.showPaywall?(d(),I(p,{key:3,"user-id":o.userId,visible:o.showPaywall,"requested-topic-id":o.requestedTopicId,onClose:e[19]||(e[19]=r=>o.showPaywall=!1),onUnlocked:l.handlePaymentSuccess},null,8,["user-id","visible","requested-topic-id","onUnlocked"])):h("",!0)])}const ts=S(E,[["render",es],["__scopeId","data-v-c8d30a2c"]]);export{ts as default};
