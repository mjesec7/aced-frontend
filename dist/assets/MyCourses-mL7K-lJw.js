import{_ as L,m as A,u as T,P as D,c,a as s,b as C,d as I,e as p,t as a,w as k,f as v,r as P,g as F,v as j,n as h,F as B,h as S,i as y,j as N,T as U,k as H,l as z,o as Q,p as q,q as V,s as d}from"./index-QU2aoPMQ.js";const E={name:"MyCoursesPage",components:{PaymentModal:D},mixins:[T],data(){return{userId:null,studyList:[],userProgress:[],loading:!0,searchQuery:"",filterProgress:"",filterSubject:"",sortBy:"recent",activeMenu:null,showPaywall:!1,requestedTopicId:null,deleteModal:{show:!1,course:null,deleting:!1}}},computed:{...A("user",{vuexUserStatus:"userStatus"}),currentUserStatus(){return this.vuexUserStatus||localStorage.getItem("userStatus")||"free"},subjects(){const t=new Set;return this.studyList.forEach(e=>{e.subject&&t.add(e.subject)}),Array.from(t).sort()},filteredCourses(){let t=[...this.studyList];if(this.searchQuery.trim()){const e=this.searchQuery.toLowerCase();t=t.filter(i=>{const n=this.getCourseName(i).toLowerCase(),r=(i.subject||"").toLowerCase();return n.includes(e)||r.includes(e)})}return this.filterProgress&&(t=t.filter(e=>{var n;const i=((n=e.progress)==null?void 0:n.percent)||0;switch(this.filterProgress){case"not-started":return i===0;case"in-progress":return i>0&&i<100;case"completed":return i===100;default:return!0}})),this.filterSubject&&(t=t.filter(e=>e.subject===this.filterSubject)),t.sort((e,i)=>{var n,r;switch(this.sortBy){case"progress":return(((n=i.progress)==null?void 0:n.percent)||0)-(((r=e.progress)==null?void 0:r.percent)||0);case"name":return this.getCourseName(e).localeCompare(this.getCourseName(i));case"level":return(e.level||0)-(i.level||0);case"recent":default:return new Date(i.lastAccessed||0)-new Date(e.lastAccessed||0)}}),t},inProgressCount(){return this.studyList.filter(t=>{var i;const e=((i=t.progress)==null?void 0:i.percent)||0;return e>0&&e<100}).length},completedCount(){return this.studyList.filter(t=>{var e;return((e=t.progress)==null?void 0:e.percent)===100}).length},totalHours(){return(this.studyList.reduce((e,i)=>{var n;return e+(((n=i.progress)==null?void 0:n.completedTime)||0)},0)/60).toFixed(1)},hasActiveFilters(){return!!(this.searchQuery||this.filterProgress||this.filterSubject||this.sortBy!=="recent")}},async mounted(){await this.initialize(),document.addEventListener("click",this.closeMenu)},beforeUnmount(){document.removeEventListener("click",this.closeMenu)},methods:{async initialize(){var t,e;if(this.userId=((e=(t=this.$store)==null?void 0:t.state)==null?void 0:e.firebaseUserId)||localStorage.getItem("firebaseUserId"),!this.userId){this.$router.push("/");return}await this.loadCourses()},async loadCourses(){try{this.loading=!0;const[t,e]=await Promise.all([q(this.userId),V(this.userId)]);e!=null&&e.success&&Array.isArray(e.data)&&(this.userProgress=e.data),t!=null&&t.success&&Array.isArray(t.data)&&(this.studyList=await this.enrichCourses(t.data))}catch{}finally{this.loading=!1}},async enrichCourses(t){const e=[];for(const i of t)if(i!=null&&i.topicId)try{const n=await z(i.topicId);let r=n!=null&&n.success?n.data:i;if(!r.lessons||r.lessons.length===0){const u=await Q(i.topicId);u!=null&&u.success&&u.data&&(r.lessons=u.data)}const l=this.calculateProgress(r.lessons);e.push({...r,progress:l,lastAccessed:i.lastAccessed||new Date().toISOString()})}catch{}return e},calculateProgress(t){if(!t||t.length===0)return{percent:0,completedLessons:0,totalLessons:0,completedTime:0,totalTime:0};let e=0,i=0,n=0;return t.forEach(r=>{const l=r.estimatedTime||r.duration||10;n+=l;const u=this.userProgress.find(g=>{var o;return(((o=g.lessonId)==null?void 0:o._id)||g.lessonId)===r._id});u!=null&&u.completed&&(e++,i+=l)}),{percent:Math.round(e/t.length*100),completedLessons:e,totalLessons:t.length,completedTime:i,totalTime:n}},getCourseName(t){return t.name||t.topicName||t.topic||t.title||"Untitled"},getTypeClass(t){return t.type||"free"},getTypeLabel(t){return{free:"Free",premium:"Start",pro:"Pro"}[t.type||"free"]||"Free"},getProgressColor(t){return t>=80?"high":t>=50?"medium":t>=30?"low":"very-low"},formatTime(t){if(!t)return"0 min";const e=Math.floor(t/60),i=t%60;return e>0?`${e}h ${i}m`:`${i} min`},getNextLesson(t){var n;if(!t.lessons||t.lessons.length===0)return"No lessons";const e=((n=t.progress)==null?void 0:n.completedLessons)||0;if(e>=t.lessons.length)return"Course completed";const i=t.lessons[e];return(i==null?void 0:i.lessonName)||(i==null?void 0:i.title)||`Lesson ${e+1}`},getCourseWord(t){return t===1?"course":"courses"},clearFilters(){this.searchQuery="",this.filterProgress="",this.filterSubject="",this.sortBy="recent"},toggleMenu(t){this.activeMenu=this.activeMenu===t?null:t},closeMenu(){this.activeMenu=null},openCourse(t){this.$router.push(`/topic/${t._id}/overview`)},continueCourse(t){if(!this.hasTopicAccess(t)){this.requestedTopicId=t._id,this.showPaywall=!0;return}this.$router.push(`/topic/${t._id}/overview`)},hasTopicAccess(t){const e=t.type||"free",i=this.currentUserStatus;return e==="free"||e==="premium"&&(i==="start"||i==="pro")||e==="pro"&&i==="pro"},showDeleteModal(t){this.deleteModal.course=t,this.deleteModal.show=!0,this.activeMenu=null},closeDeleteModal(){this.deleteModal.show=!1,this.deleteModal.course=null,this.deleteModal.deleting=!1},async confirmDelete(){if(!(!this.deleteModal.course||this.deleteModal.deleting))try{this.deleteModal.deleting=!0,await H(this.userId,this.deleteModal.course._id),this.studyList=this.studyList.filter(t=>t._id!==this.deleteModal.course._id),window.eventBus&&window.eventBus.emit("studyListUpdated"),this.closeDeleteModal()}catch{alert("Failed to delete course"),this.deleteModal.deleting=!1}},handlePaymentSuccess(t){this.showPaywall=!1,this.$forceUpdate()}}},G={class:"my-courses-page"},O={class:"page-header"},W={class:"header-content"},Y={class:"header-left"},J={class:"page-subtitle"},K={class:"header-actions"},X={class:"filters-section"},Z={class:"filters-content"},R={class:"search-box"},$={class:"filter-chips"},ee={class:"filter-group"},se={class:"chips-row"},te={key:0,class:"filter-group"},oe={class:"chips-row"},re=["onClick"],le={class:"filter-group"},ie={class:"chips-row"},ne={class:"stats-overview"},ae={class:"stat-item"},de={class:"stat-info"},ce={class:"stat-value"},ue={class:"stat-item"},ve={class:"stat-info"},he={class:"stat-value"},pe={class:"stat-item"},ge={class:"stat-info"},fe={class:"stat-value"},ye={class:"stat-item"},me={class:"stat-info"},Ce={class:"stat-value"},ke={key:0,class:"loading-state"},we={key:1,class:"empty-state"},be={class:"empty-title"},xe={class:"empty-text"},Me={class:"empty-actions"},_e={key:2,class:"courses-grid"},Pe=["onClick"],Be={class:"course-header"},Se={class:"course-menu"},Le=["onClick"],Ae=["onClick"],Te=["onClick"],De={class:"course-content"},Ie={class:"course-title"},Fe={class:"course-meta"},je={class:"meta-tag"},Ne={class:"meta-tag"},Ue={class:"progress-section"},He={class:"progress-info"},ze={class:"progress-value"},Qe={class:"progress-bar-wrapper"},qe={class:"progress-stats"},Ve={class:"progress-percent"},Ee={class:"time-spent"},Ge={class:"course-footer"},Oe={class:"next-lesson"},We=["onClick"],Ye={class:"modal-header"},Je={class:"modal-body"},Ke={class:"modal-text"},Xe={class:"modal-footer"},Ze=["disabled"],Re={key:0},$e={key:1,class:"deleting-text"};function es(t,e,i,n,r,l){const u=P("router-link"),g=P("PaymentModal");return d(),c("div",G,[s("div",O,[s("div",W,[s("div",Y,[s("button",{class:"back-btn",onClick:e[0]||(e[0]=o=>t.$router.push("/profile/main"))},e[20]||(e[20]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"15 18 9 12 15 6"})],-1)])),s("div",null,[e[21]||(e[21]=s("h1",{class:"page-title"},"My Courses",-1)),s("p",J,a(l.filteredCourses.length)+" "+a(l.getCourseWord(l.filteredCourses.length)),1)])]),s("div",K,[C(u,{to:"/profile/catalogue",class:"add-course-btn"},{default:k(()=>e[22]||(e[22]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),v(" Add Course ")])),_:1})])])]),s("div",X,[s("div",Z,[s("div",R,[e[24]||(e[24]=s("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"11",cy:"11",r:"8"}),s("path",{d:"m21 21-4.35-4.35"})],-1)),F(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.searchQuery=o),type:"text",class:"search-input",placeholder:"Search courses..."},null,512),[[j,r.searchQuery]]),r.searchQuery?(d(),c("button",{key:0,onClick:e[2]||(e[2]=o=>r.searchQuery=""),class:"clear-search-btn"},e[23]||(e[23]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))):p("",!0)]),s("div",$,[s("div",ee,[e[25]||(e[25]=s("label",{class:"filter-label"},"Progress:",-1)),s("div",se,[s("button",{class:h(["filter-chip",{active:r.filterProgress===""}]),onClick:e[3]||(e[3]=o=>r.filterProgress="")}," All ",2),s("button",{class:h(["filter-chip",{active:r.filterProgress==="not-started"}]),onClick:e[4]||(e[4]=o=>r.filterProgress="not-started")}," Not Started ",2),s("button",{class:h(["filter-chip",{active:r.filterProgress==="in-progress"}]),onClick:e[5]||(e[5]=o=>r.filterProgress="in-progress")}," In Progress ",2),s("button",{class:h(["filter-chip",{active:r.filterProgress==="completed"}]),onClick:e[6]||(e[6]=o=>r.filterProgress="completed")}," Completed ",2)])]),l.subjects.length>0?(d(),c("div",te,[e[26]||(e[26]=s("label",{class:"filter-label"},"Subject:",-1)),s("div",oe,[s("button",{class:h(["filter-chip",{active:r.filterSubject===""}]),onClick:e[7]||(e[7]=o=>r.filterSubject="")}," All ",2),(d(!0),c(B,null,S(l.subjects,o=>(d(),c("button",{key:o,class:h(["filter-chip",{active:r.filterSubject===o}]),onClick:m=>r.filterSubject=o},a(o),11,re))),128))])])):p("",!0),s("div",le,[e[27]||(e[27]=s("label",{class:"filter-label"},"Sort By:",-1)),s("div",ie,[s("button",{class:h(["filter-chip",{active:r.sortBy==="recent"}]),onClick:e[8]||(e[8]=o=>r.sortBy="recent")}," By Date ",2),s("button",{class:h(["filter-chip",{active:r.sortBy==="progress"}]),onClick:e[9]||(e[9]=o=>r.sortBy="progress")}," By Progress ",2),s("button",{class:h(["filter-chip",{active:r.sortBy==="name"}]),onClick:e[10]||(e[10]=o=>r.sortBy="name")}," By Name ",2)])])]),l.hasActiveFilters?(d(),c("button",{key:0,onClick:e[11]||(e[11]=(...o)=>l.clearFilters&&l.clearFilters(...o)),class:"clear-all-btn"},e[28]||(e[28]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),v(" Clear Filters ")]))):p("",!0)])]),s("div",ne,[s("div",ae,[e[30]||(e[30]=s("div",{class:"stat-icon purple"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),s("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})])],-1)),s("div",de,[s("div",ce,a(r.studyList.length),1),e[29]||(e[29]=s("div",{class:"stat-label"},"Total",-1))])]),s("div",ue,[e[32]||(e[32]=s("div",{class:"stat-icon blue"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})])],-1)),s("div",ve,[s("div",he,a(l.inProgressCount),1),e[31]||(e[31]=s("div",{class:"stat-label"},"In Progress",-1))])]),s("div",pe,[e[34]||(e[34]=s("div",{class:"stat-icon green"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"20 6 9 17 4 12"})])],-1)),s("div",ge,[s("div",fe,a(l.completedCount),1),e[33]||(e[33]=s("div",{class:"stat-label"},"Completed",-1))])]),s("div",ye,[e[36]||(e[36]=s("div",{class:"stat-icon orange"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"12",cy:"12",r:"10"}),s("polyline",{points:"12 6 12 12 16 14"})])],-1)),s("div",me,[s("div",Ce,a(l.totalHours)+"h",1),e[35]||(e[35]=s("div",{class:"stat-label"},"Studied",-1))])])]),r.loading?(d(),c("div",ke,e[37]||(e[37]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading courses...",-1)]))):l.filteredCourses.length===0?(d(),c("div",we,[e[39]||(e[39]=s("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),s("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})],-1)),s("h3",be,a(l.hasActiveFilters?"No courses found":"You don't have any courses yet"),1),s("p",xe,a(l.hasActiveFilters?"Try changing your search filters":"Add courses from the catalog to start learning"),1),s("div",Me,[l.hasActiveFilters?(d(),c("button",{key:0,onClick:e[12]||(e[12]=(...o)=>l.clearFilters&&l.clearFilters(...o)),class:"secondary-btn"}," Clear Filters ")):p("",!0),C(u,{to:"/profile/catalogue",class:"primary-btn"},{default:k(()=>e[38]||(e[38]=[v(" Go to Catalog ")])),_:1})])])):(d(),c("div",_e,[(d(!0),c(B,null,S(l.filteredCourses,o=>{var m,w,b,x,M,_;return d(),c("div",{key:o._id,class:"course-card",onClick:f=>l.openCourse(o)},[s("div",Be,[s("span",{class:h(["course-type-badge",l.getTypeClass(o)])},a(l.getTypeLabel(o)),3),s("div",Se,[s("button",{class:"menu-btn",onClick:y(f=>l.toggleMenu(o._id),["stop"])},e[40]||(e[40]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"12",cy:"12",r:"1"}),s("circle",{cx:"12",cy:"5",r:"1"}),s("circle",{cx:"12",cy:"19",r:"1"})],-1)]),8,Le),r.activeMenu===o._id?(d(),c("div",{key:0,class:"menu-dropdown",onClick:e[13]||(e[13]=y(()=>{},["stop"]))},[s("button",{onClick:f=>l.openCourse(o),class:"menu-item"},e[41]||(e[41]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polygon",{points:"5 3 19 12 5 21 5 3"})],-1),v(" Open Course ")]),8,Ae),s("button",{onClick:f=>l.showDeleteModal(o),class:"menu-item danger"},e[42]||(e[42]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"3 6 5 6 21 6"}),s("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1),v(" Delete ")]),8,Te)])):p("",!0)])]),s("div",De,[s("h3",Ie,a(l.getCourseName(o)),1),s("div",Fe,[s("span",je,[e[43]||(e[43]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})],-1)),v(" "+a(o.subject||"General"),1)]),s("span",Ne,[e[44]||(e[44]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})],-1)),v(" Level "+a(o.level||1),1)])]),s("div",Ue,[s("div",He,[e[45]||(e[45]=s("span",{class:"progress-label"},"Progress",-1)),s("span",ze,a(((m=o.progress)==null?void 0:m.completedLessons)||0)+"/"+a(((w=o.lessons)==null?void 0:w.length)||0),1)]),s("div",Qe,[s("div",{class:h(["progress-bar",l.getProgressColor(((b=o.progress)==null?void 0:b.percent)||0)]),style:N({width:`${((x=o.progress)==null?void 0:x.percent)||0}%`})},null,6)]),s("div",qe,[s("span",Ve,a(((M=o.progress)==null?void 0:M.percent)||0)+"%",1),s("span",Ee,a(l.formatTime((_=o.progress)==null?void 0:_.completedTime)),1)])])]),s("div",Ge,[s("div",Oe,[e[46]||(e[46]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"12",cy:"12",r:"10"}),s("polyline",{points:"12 6 12 12 16 14"})],-1)),s("span",null,a(l.getNextLesson(o)),1)]),s("button",{onClick:y(f=>l.continueCourse(o),["stop"]),class:"continue-btn"},e[47]||(e[47]=[v(" Continue "),s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"9 18 15 12 9 6"})],-1)]),8,We)])],8,Pe)}),128))])),C(U,{name:"modal"},{default:k(()=>[r.deleteModal.show?(d(),c("div",{key:0,class:"modal-overlay",onClick:e[18]||(e[18]=(...o)=>l.closeDeleteModal&&l.closeDeleteModal(...o))},[s("div",{class:"modal-container",onClick:e[17]||(e[17]=y(()=>{},["stop"]))},[s("div",Ye,[e[49]||(e[49]=s("div",{class:"modal-icon danger"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),s("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),s("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})])],-1)),s("button",{class:"modal-close",onClick:e[14]||(e[14]=(...o)=>l.closeDeleteModal&&l.closeDeleteModal(...o))},e[48]||(e[48]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))]),s("div",Je,[e[52]||(e[52]=s("h3",{class:"modal-title"},"Delete Course?",-1)),s("p",Ke,[e[50]||(e[50]=v(" Are you sure you want to delete the course ")),s("strong",null,a(r.deleteModal.course?l.getCourseName(r.deleteModal.course):""),1),e[51]||(e[51]=v("? This action cannot be undone. "))])]),s("div",Xe,[s("button",{onClick:e[15]||(e[15]=(...o)=>l.closeDeleteModal&&l.closeDeleteModal(...o)),class:"modal-btn secondary"}," Cancel "),s("button",{onClick:e[16]||(e[16]=(...o)=>l.confirmDelete&&l.confirmDelete(...o)),class:"modal-btn danger",disabled:r.deleteModal.deleting},[r.deleteModal.deleting?(d(),c("span",$e,e[53]||(e[53]=[s("span",{class:"spinner-small"},null,-1),v(" Deleting... ")]))):(d(),c("span",Re,"Delete"))],8,Ze)])])])):p("",!0)]),_:1}),r.showPaywall?(d(),I(g,{key:3,"user-id":r.userId,visible:r.showPaywall,"requested-topic-id":r.requestedTopicId,onClose:e[19]||(e[19]=o=>r.showPaywall=!1),onUnlocked:l.handlePaymentSuccess},null,8,["user-id","visible","requested-topic-id","onUnlocked"])):p("",!0)])}const ts=L(E,[["render",es],["__scopeId","data-v-f24eae7a"]]);export{ts as default};
